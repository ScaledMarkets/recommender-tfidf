version: '3'
services:
  mysql:
    container_name: mysql
    image: mysql:8.0.3
    environment:
      - MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
      - MYSQL_DATABASE=mysql
      - MYSQL_USER=${MYSQL_USER}
      - MYSQL_PASSWORD=${MYSQL_PASSWORD}
    # If database is empty, then create schema and load data from loaddata.
    # Schema: "UserData" has columns 'UserID', 'ItemID', 'Preference', and 'Timestamp'.
    # Ref: https://stackoverflow.com/questions/29145370/how-can-i-initialize-a-mysql-database-with-schema-in-a-docker-container
    ports:
      - 3306
    restart: always
    volumes:
      - "dbdata:/var/lib/mysql"
      - "dbcreate:/docker-entrypoint-initdb.d"
    links:
  recommender:
    image: ${UserSimRecImageName}
    # Provice arguments for the entrypoint, which is specified in the Dockerfile:
    command: ["mysql", "localhost", "3306", "UserData", "${MYSQL_USER}", "${MYSQL_PASSWORD}"]
    depends_on:
      - mysql
    links:
      - mysql
volumes:
  dbdata
  dbcreate:
    external: true
